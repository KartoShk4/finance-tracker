<div class="item-details-page">
  <!-- Кнопка назад -->
  <a routerLink="/" class="back-button">← Назад к списку</a>

  <!-- Форма добавления транзакции -->
  <div class="transaction-form">
    <div class="form-info" *ngIf="currentItem()">
      <span class="category-badge" [class.income]="currentItem()!.category === 'income'" [class.expense]="currentItem()!.category === 'expense'">
        {{ currentItem()!.category === 'income' ? 'Доход' : 'Расход' }}
      </span>
      <span class="category-title">{{ currentItem()!.title }}</span>
    </div>
    <form (submit)="addTransaction(); $event.preventDefault()">
      <div class="form-row">
        <input 
          type="number" 
          [(ngModel)]="amount" 
          name="amount" 
          placeholder="Сумма"
          min="0.01"
          step="0.01"
          required />
        <app-date-time-picker
          [(ngModel)]="transactionDate"
          name="transactionDate">
        </app-date-time-picker>
        <button type="submit">Добавить транзакцию</button>
      </div>
      <div class="form-row">
        <input 
          type="text" 
          [(ngModel)]="notes" 
          name="notes" 
          placeholder="Примечание (необязательно)"
          maxlength="500" />
      </div>
    </form>
  </div>

  <!-- Список транзакций -->
  <div class="transactions-list">
    <div 
      *ngFor="let t of transactions()"
      class="transaction-item">
      <div class="transaction-item-content">
        <div class="transaction-main-info">
          <span 
            class="transaction-type"
            [class.income]="t.type === 'income'"
            [class.expense]="t.type === 'expense'">
            {{ t.type === 'income' ? 'Доход' : 'Расход' }}
          </span>
          <span class="transaction-date">
            {{ t.date | localDate:'short' }}
          </span>
        </div>
        <div 
          *ngIf="t.notes" 
          class="transaction-notes"
          [title]="t.notes.length > 50 ? t.notes : ''">
          {{ t.notes.length > 50 ? (t.notes | slice:0:50) + '...' : t.notes }}
        </div>
      </div>
      <div class="transaction-item-actions">
        <div 
          class="transaction-amount"
          [class.income]="t.type === 'income'"
          [class.expense]="t.type === 'expense'">
          {{ t.type === 'income' ? '+' : '-' }}{{ t.amount | number:'1.2-2' }} ₽
        </div>
        <button 
          class="delete-button"
          (click)="deleteTransaction(t.id)"
          title="Удалить транзакцию">
          ×
        </button>
      </div>
    </div>
    
    <!-- Пустое состояние -->
    <div *ngIf="transactions().length === 0" class="transactions-empty">
      <p>Нет транзакций. Добавьте первую транзакцию для отслеживания финансов.</p>
    </div>
  </div>

  <!-- График транзакций по периодам -->
  <app-chart
    [labels]="chartData().labels"
    [data]="chartData().data"
    [period]="selectedPeriod()"
    (periodChange)="selectedPeriod.set($event)">
  </app-chart>
</div>
