<div class="home-page">
  <div class="home-layout">
    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥–µ–º–æ-—Ä–µ–∂–∏–º–∞ -->
    @if (isDemoMode()) {
      <div class="demo-form-hint">
        @if (canCreateInDemo()) {
          <span>
            –í—ã –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞—Ç—å {{ DEMO_LIMIT - userItemsCount() }}
            –∫–∞—Ç–µ–≥–æ—Ä–∏{{ DEMO_LIMIT - userItemsCount() === 1 ? '—é' : '–∏' }} –¥–ª—è —Ç–µ—Å—Ç–∞.
            –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π.
          </span>
        }
        @if (!canCreateInDemo()) {
          <span>
            –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –¥–µ–º–æ-—Ä–µ–∂–∏–º–∞ ({{ DEMO_LIMIT }} –∫–∞—Ç–µ–≥–æ—Ä–∏–∏). –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π.
          </span>
        }
      </div>
    }

    <div class="home-content">
      <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ item -->
      <div class="home-form" [class.demo-disabled]="isDemoMode() && !canCreateInDemo()">
        <form (submit)="add($event)">
          <div class="form-row">
            <input
              type="text"
              [(ngModel)]="title"
              name="title"
              [placeholder]="isDemoMode() && !canCreateInDemo() ? '–õ–∏–º–∏—Ç –¥–æ—Å—Ç–∏–≥–Ω—É—Ç. –í–æ–π–¥–∏—Ç–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è' : (isDemoMode() ? `–î–µ–º–æ: –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å ${DEMO_LIMIT - userItemsCount()} –∫–∞—Ç–µ–≥–æ—Ä–∏${DEMO_LIMIT - userItemsCount() === 1 ? '—é' : '–∏'}` : '–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏')"
              [disabled]="isDemoMode() && !canCreateInDemo()"
              required/>
            <button type="submit" [disabled]="isDemoMode() && !canCreateInDemo()">–î–æ–±–∞–≤–∏—Ç—å</button>
          </div>
        </form>
      </div>

      <!-- –°–ø–∏—Å–æ–∫ items -->
      <div class="items-list">
        @for (item of items(); track trackByItemId($index, item)) {
          <div class="items-item" [class.favorite]="item.isFavorite">
            <div class="items-item-content">
              <button
                class="favorite-button"
                [class.active]="item.isFavorite"
                (click)="toggleFavorite(item.id, $event)"
                title="{{ item.isFavorite ? '–£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ' : '–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ' }}">
                ‚òÖ
              </button>
              <div class="items-item-info" (click)="open(item.id)">
                <div class="items-item-title">{{ item.title }}</div>
                <div class="items-item-meta">
          <span class="items-item-date">
            –û–±–Ω–æ–≤–ª–µ–Ω–æ: {{ item.lastUpdated | localDate:'short' }}
          </span>
                </div>
              </div>
            </div>
          </div>
        }


        <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ -->
        @if (items().length === 0) {
          <div class="items-empty">
            <p>–ù–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤.</p>
          </div>
        }
      </div>
    </div>

    <!-- –ì—Ä–∞—Ñ–∏–∫ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞ -->
    <div class="home-chart desktop-chart">
      <div class="home-charts-container">
        <div class="home-period-controls">
          @for (p of periods; track p.value) {
            <button
              class="home-period-button"
              [class.active]="selectedPeriod() === p.value"
              (click)="selectedPeriod.set(p.value)">
              {{ p.label }}
            </button>
          }
        </div>
        <!-- –ü–µ—Ä–≤—ã–π –≥—Ä–∞—Ñ–∏–∫: –æ–±—â–∏–µ –¥–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã -->
        <app-pie-chart
          [income]="statistics().income"
          [expense]="statistics().expense">
        </app-pie-chart>
        <!-- –í—Ç–æ—Ä–æ–π –≥—Ä–∞—Ñ–∏–∫: –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –∏—Ö –¥–æ—Ö–æ–¥–∞–º–∏ –∏ —Ä–∞—Å—Ö–æ–¥–∞–º–∏ -->
        <app-categories-chart
          [categories]="categoriesChartData()">
        </app-categories-chart>
      </div>
    </div>

    <!-- –ì—Ä–∞—Ñ–∏–∫ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö (–∞–∫–∫–æ—Ä–¥–µ–æ–Ω) -->
    <div class="mobile-chart">
      <button class="accordion-toggle" (click)="toggleMobileChart()">
        {{ showMobileChart ? '–°–∫—Ä—ã—Ç—å –≥—Ä–∞—Ñ–∏–∫' : '–ü–æ–∫–∞–∑–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫' }}
      </button>
      <div class="mobile-chart-panel" [class.open]="showMobileChart">
        <div class="mobile-charts-container">
          <div class="home-period-controls">
            @for (p of periods; track p.value) {
              <button
                class="home-period-button"
                [class.active]="selectedPeriod() === p.value"
                (click)="selectedPeriod.set(p.value)">
                {{ p.label }}
              </button>
            }
          </div>
          <!-- –ü–µ—Ä–≤—ã–π –≥—Ä–∞—Ñ–∏–∫: –æ–±—â–∏–µ –¥–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã -->
          <app-pie-chart
            [income]="statistics().income"
            [expense]="statistics().expense">
          </app-pie-chart>
          <!-- –í—Ç–æ—Ä–æ–π –≥—Ä–∞—Ñ–∏–∫: –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –∏—Ö –¥–æ—Ö–æ–¥–∞–º–∏ –∏ —Ä–∞—Å—Ö–æ–¥–∞–º–∏ -->
          <app-categories-chart
            [categories]="categoriesChartData()">
          </app-categories-chart>
        </div>
      </div>
    </div>
  </div>



  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –∏–∑–±—Ä–∞–Ω–Ω–æ–º -->
  <app-modal
    [isOpen]="showFavoriteModal()"
    title="–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è"
    [showCancel]="false"
    confirmText="–ü–æ–Ω—è—Ç–Ω–æ"
    (confirm)="showFavoriteModal.set(false)"
    (closeEvent)="showFavoriteModal.set(false)">
    <p>–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É, —á—Ç–æ–±—ã –∏–∑–º–µ–Ω—è—Ç—å –∏–∑–±—Ä–∞–Ω–Ω–æ–µ.</p>
    <p style="margin-top: var(--space-md); color: var(--color-text-secondary);">
      –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ VK, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
    </p>
  </app-modal>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ –ª–∏–º–∏—Ç–µ –≤ –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ -->
  <app-modal
    [isOpen]="showDemoLimitModal()"
    title="–õ–∏–º–∏—Ç –¥–µ–º–æ-—Ä–µ–∂–∏–º–∞ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç"
    [showCancel]="false"
    confirmText="–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É"
    [confirmDanger]="false"
    (confirm)="scrollToTop(); showDemoLimitModal.set(false)"
    (closeEvent)="showDemoLimitModal.set(false)">
    <p>
      –í –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ –≤—ã –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞—Ç—å —Ç–æ–ª—å–∫–æ <strong>{{ DEMO_LIMIT }} –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</strong> –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞.
    </p>
    <p style="margin-top: var(--space-md); color: var(--color-text-secondary);">
      –í—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–ª–∏ {{ userItemsCount() }} –∫–∞—Ç–µ–≥–æ—Ä–∏{{ userItemsCount() === 1 ? '—é' : '–∏' }} –∏ —É–≤–∏–¥–µ–ª–∏, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
      –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.
    </p>
    <p style="margin-top: var(--space-md); color: var(--color-text-primary); font-weight: 500;">
      üîê <strong>–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ VK</strong>, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º:
    </p>
    <ul style="margin-top: var(--space-sm); padding-left: var(--space-lg); color: var(--color-text-secondary);">
      <li>–ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π</li>
      <li>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ</li>
      <li>–î–æ—Å—Ç—É–ø —Å –ª—é–±–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</li>
      <li>–ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</li>
    </ul>
  </app-modal>
</div>
