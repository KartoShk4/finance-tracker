<div class="home-page">
  <div class="home-layout">
    <div class="home-content">
      <!-- Форма добавления нового item -->
      <div class="home-form">
        <form (submit)="add(); $event.preventDefault()">
          <div class="form-row">
            <input 
              type="text" 
              [(ngModel)]="title" 
              name="title" 
              placeholder="Название категории"
              required />
            <select [(ngModel)]="category" name="category">
              <option value="income">Доход</option>
              <option value="expense">Расход</option>
            </select>
            <button type="submit">Добавить</button>
          </div>
        </form>
      </div>

      <!-- Фильтр по типу категории -->
      <div class="home-filter">
        <button
          class="filter-button"
          [class.active]="categoryFilter() === 'all'"
          (click)="categoryFilter.set('all')">
          Все
        </button>
        <button
          class="filter-button"
          [class.active]="categoryFilter() === 'income'"
          (click)="categoryFilter.set('income')">
          Доходы
        </button>
        <button
          class="filter-button"
          [class.active]="categoryFilter() === 'expense'"
          (click)="categoryFilter.set('expense')">
          Расходы
        </button>
      </div>

      <!-- Список items -->
      <div class="items-list" cdkDropList (cdkDropListDropped)="onDrop($event)">
        <div 
          *ngFor="let item of items(); trackBy: trackByItemId"
          class="items-item"
          [class.favorite]="item.isFavorite"
          cdkDrag>
          <div class="items-item-content" (click)="open(item.id)">
            <button 
              class="favorite-button"
              [class.active]="item.isFavorite"
              (click)="toggleFavorite(item.id, $event)"
              title="{{ item.isFavorite ? 'Убрать из избранного' : 'Добавить в избранное' }}">
              ★
            </button>
            <div class="items-item-info">
              <div class="items-item-title">{{ item.title }}</div>
              <div class="items-item-meta">
                <span class="items-item-date">
                  Обновлено: {{ item.lastUpdated | localDate:'short' }}
                </span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Пустое состояние -->
        <div *ngIf="items().length === 0" class="items-empty">
          <p>Нет категорий. Создайте первую категорию для отслеживания финансов.</p>
        </div>
      </div>
    </div>

    <!-- График для десктопа -->
    <div class="home-chart desktop-chart">
      <div class="home-charts-container">
        <div class="home-period-controls">
          <button
            *ngFor="let p of periods"
            class="home-period-button"
            [class.active]="selectedPeriod() === p.value"
            (click)="selectedPeriod.set(p.value)">
            {{ p.label }}
          </button>
        </div>
        <app-pie-chart
          [income]="statistics().income"
          [expense]="statistics().expense">
        </app-pie-chart>
      </div>
    </div>
  </div>

  <!-- График для мобильных (аккордеон) -->
  <div class="mobile-chart">
    <button class="accordion-toggle" (click)="toggleMobileChart()">
      {{ showMobileChart ? 'Скрыть график' : 'Показать график' }}
    </button>
    <div class="mobile-chart-panel" [class.open]="showMobileChart">
      <div class="mobile-charts-container">
        <div class="home-period-controls">
          <button
            *ngFor="let p of periods"
            class="home-period-button"
            [class.active]="selectedPeriod() === p.value"
            (click)="selectedPeriod.set(p.value)">
            {{ p.label }}
          </button>
        </div>
        <app-pie-chart
          [income]="statistics().income"
          [expense]="statistics().expense">
        </app-pie-chart>
      </div>
    </div>
  </div>
</div>
